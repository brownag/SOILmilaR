<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Similar Soils with Loafercreek • SOILmilaR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Similar Soils with Loafercreek">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SOILmilaR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/similar-soils-loafercreek.html">Similar Soils with Loafercreek</a></li>
    <li><a class="dropdown-item" href="../articles/synthetic-transects.html">Synthetic Transects</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="http://github.com/brownag/SOILmilaR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Similar Soils with Loafercreek</h1>
            
      
      <small class="dont-index">Source: <a href="http://github.com/brownag/SOILmilaR/blob/main/vignettes/similar-soils-loafercreek.Rmd" class="external-link"><code>vignettes/similar-soils-loafercreek.Rmd</code></a></small>
      <div class="d-none name"><code>similar-soils-loafercreek.Rmd</code></div>
    </div>

    
    
<p>In this vignette we will use “real” NASIS data via the
<code>loafercreek</code> data set.</p>
<p>The <code>loafercreek</code> dataset includes soils that are
generally similar to Loafercreek series concept, and occur spatially
within a mapunit where Loafercreek or related soil is a major component.
These mapunits are currently used in the Calaveras, Tuolumne, Mariposa
and Butte county areas of California.</p>
<p><code>loafercreek</code> is a <em>SoilProfileCollection</em> object.
This is a special data structure defined by the {aqp} (Algorithms for
Quantitative Pedology) package intended for managing soil horizon data,
representing various depths within a soil “profile”, along with
“site-level” data that corresponds to the point location or profile in
aggregate.</p>
<p>A variety of {aqp} functions are used to calculate site-level
characteristics that are used in hierarchical clustering methods from
{stats} and {cluster} as well as similar soils calculations available
via the {SOILmilaR} package. Methods for visualizing clusters are
provided by the {aqp} package.</p>
<hr>
<p>First we load the required packages and datasets.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/brownag/SOILmilaR" class="external-link">SOILmilaR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncss-tech/aqp" class="external-link">aqp</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is aqp 2.2-1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncss-tech/soilDB/" class="external-link">soilDB</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"loafercreek"</span>, package<span class="op">=</span><span class="st">"soilDB"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">spc</span> <span class="op">&lt;-</span> <span class="va">loafercreek</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">loafercreek</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## alternately, use NASIS data</span></span>
<span><span class="co"># spc &lt;- fetchNASIS()</span></span></code></pre></div>
<p>To use your own NASIS data you can replace the <code>spc</code>
object (a random subset of <code>loafercreek</code>) with a call to
<code><a href="http://ncss-tech.github.io/soilDB/reference/fetchNASIS.html" class="external-link">soilDB::fetchNASIS()</a></code>. The loafercreek object is a sample
dataset stored in the {soilDB} package; therefore it does not require a
NASIS installation or account to use.</p>
<p>Next, we define some rating functions that can be used for generating
variables that can be used in comparing soils and assessing overall
similarity.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rate_taxpartsize</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sandy-skeletal"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sandy"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loamy"</span>, <span class="st">"coarse-loamy"</span>, <span class="st">"coarse-silty"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">5</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fine-loamy"</span>, <span class="st">"fine-silty"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">7</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clayey"</span>, <span class="st">"fine"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">9</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"very-fine"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">11</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loamy-skeletal"</span>, <span class="st">"clayey-skeletal"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">13</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rate_depthclass</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>                            <span class="va">breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                              `very shallow` <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                              `shallow` <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                              `moderately deep` <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                              `deep` <span class="op">=</span> <span class="fl">150</span>,</span>
<span>                              `very deep` <span class="op">=</span> <span class="fl">1e4</span></span>
<span>                            <span class="op">)</span>,</span>
<span>                            <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">breaks</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">res</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here we use several {aqp} functions to estimate the particle size
control section boundaries, the depth to a root-restrictive layer, and
apply our rating functions to the depth and particle size class as
populated in NASIS.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/estimatePSCS.html" class="external-link">estimatePSCS</a></span><span class="op">(</span><span class="va">spc</span>, clay.attr <span class="op">=</span> <span class="st">"claytotest"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate soil depth</span></span>
<span><span class="va">spc</span><span class="op">$</span><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/depthOf.html" class="external-link">minDepthOf</a></span><span class="op">(</span><span class="va">spc</span>, pattern <span class="op">=</span> <span class="st">"R|Cr|Cd|kk|m"</span><span class="op">)</span><span class="op">[[</span><span class="fu">aqp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/horizonDepths.html" class="external-link">horizonDepths</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/similar_soils.html">similar_soils</a></span><span class="op">(</span><span class="va">spc</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dp <span class="op">=</span> <span class="va">rate_depthclass</span>,</span>
<span>                             taxpartsize <span class="op">=</span> <span class="va">rate_taxpartsize</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; comparing to dominant reference condition (`3.7` on 17 rows)</span></span>
<span></span>
<span><span class="co"># transfer some ordinal ratings</span></span>
<span><span class="va">spc</span><span class="op">$</span><span class="va">rd</span> <span class="op">=</span> <span class="va">s</span><span class="op">$</span><span class="va">dp</span> <span class="co"># depth class</span></span>
<span><span class="va">spc</span><span class="op">$</span><span class="va">rt</span> <span class="op">=</span> <span class="va">s</span><span class="op">$</span><span class="va">taxpartsize</span> <span class="co"># particle size class</span></span></code></pre></div>
<p>We also calculate the weighted average clay content (<code>pc</code>)
and percent volume rock fragments (<code>pf</code>) in the particle size
control section we calculated above with
<code><a href="https://rdrr.io/pkg/aqp/man/estimatePSCS.html" class="external-link">aqp::estimatePSCS()</a></code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate some continuous quantities for PSCS, join to site data</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/mutate_profile.html" class="external-link">mutate_profile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">trunc</a></span><span class="op">(</span><span class="va">spc</span>, <span class="va">spc</span><span class="op">$</span><span class="va">pscs_top</span>, <span class="va">spc</span><span class="op">$</span><span class="va">pscs_bottom</span><span class="op">)</span>,</span>
<span>  pc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">clay</span>, <span class="va">hzdepb</span> <span class="op">-</span> <span class="va">hzdept</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>  pf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">total_frags_pct</span>, <span class="va">hzdepb</span> <span class="op">-</span> <span class="va">hzdept</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peiid"</span>, <span class="st">"pc"</span>, <span class="st">"pf"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We will now build several models with increasing complexity of the
input data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set up data frames for various clustering models</span></span>
<span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"taxpartsize"</span>, <span class="st">"rd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"rd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pc"</span>, <span class="st">"pf"</span>, <span class="st">"rd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pc"</span>, <span class="st">"pf"</span>, <span class="st">"dp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"rd"</span>, <span class="st">"pc"</span>, <span class="st">"pf"</span>, <span class="st">"dp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The simplest model we construct uses the particle size family and the
depth class.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/agnes.html" class="external-link">agnes</a></span><span class="op">(</span><span class="va">x0</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span>,<span class="op">]</span>, method <span class="op">=</span> <span class="st">"gaverage"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="va">m0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="similar-soils-loafercreek_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
<p>If we transform the particle size family, we have the option to
combine similar classes, and also increase the taxonomic distance
between other classes.</p>
<p>In this case, we code “fine-loamy” as a 4 and “loamy-skeletal” as a
7. The groups created by branching in the tree are identical to the
simplest model, but the taxonomic distance between the two main groups
of pedons is now greater (3 versus 1).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/agnes.html" class="external-link">agnes</a></span><span class="op">(</span><span class="va">x1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span>, <span class="op">]</span>, method <span class="op">=</span> <span class="st">"gaverage"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="similar-soils-loafercreek_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
<p>In the next most complex model we replace the taxonomic particle size
class rating with the PSCS weighted average percent clay and the percent
fragments.</p>
<p>We find the same “outgroup” of three pedons we separated earlier, the
magnitude of taxonomic distances (y axis) further increases, and we get
a lot more subtle variation within that reflects more continuous
variation in PSCS clay and fragments.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/agnes.html" class="external-link">agnes</a></span><span class="op">(</span><span class="va">x2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>,<span class="op">]</span>, method <span class="op">=</span> <span class="st">"gaverage"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="similar-soils-loafercreek_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Since most of the soils in the <code>loafercreek</code> dat set are
moderately deep we do not get much information from the depth class
grouping. So, instead, in the next model we replace the depth class with
the actual depth to root-limiting layer. We find again that the
loamy-skeletal soils are separated, and some distances of groups within
the fine-loamy soils shift, but ultimately there is little effect as the
variation is still constrained within moderately deep depth class.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/agnes.html" class="external-link">agnes</a></span><span class="op">(</span><span class="va">x3</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">x3</span><span class="op">)</span>,<span class="op">]</span>, method <span class="op">=</span> <span class="st">"gaverage"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="similar-soils-loafercreek_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"></p>
<p>If we add the <code>taxpartsize</code> and depth class ratings back
in with the continuous data we see that we get the exact same clustering
as with the prior model (which included no categorical predictors). This
indicates the categories are adequately covered by the numeric
quantities we replaced them with.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/agnes.html" class="external-link">agnes</a></span><span class="op">(</span><span class="va">x4</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">x4</span><span class="op">)</span>,<span class="op">]</span>, method <span class="op">=</span> <span class="st">"gaverage"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="similar-soils-loafercreek_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></p>
<table class="table">
<thead><tr class="header">
<th align="left">peiid</th>
<th align="left">taxpartsize</th>
<th align="right">rt</th>
<th align="right">dp</th>
<th align="right">rd</th>
<th align="right">pc</th>
<th align="right">pf</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">115595</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">74</td>
<td align="right">3</td>
<td align="right">27.14000</td>
<td align="right">4.60000</td>
</tr>
<tr class="even">
<td align="left">268820</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">64</td>
<td align="right">3</td>
<td align="right">29.46000</td>
<td align="right">15.76000</td>
</tr>
<tr class="odd">
<td align="left">338023</td>
<td align="left">loamy-skeletal</td>
<td align="right">13</td>
<td align="right">66</td>
<td align="right">3</td>
<td align="right">23.95652</td>
<td align="right">65.26829</td>
</tr>
<tr class="even">
<td align="left">338040</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">81</td>
<td align="right">3</td>
<td align="right">27.12500</td>
<td align="right">26.25000</td>
</tr>
<tr class="odd">
<td align="left">351716</td>
<td align="left">loamy-skeletal</td>
<td align="right">13</td>
<td align="right">63</td>
<td align="right">3</td>
<td align="right">28.80000</td>
<td align="right">54.42000</td>
</tr>
<tr class="even">
<td align="left">374205</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">66</td>
<td align="right">3</td>
<td align="right">30.72000</td>
<td align="right">17.36000</td>
</tr>
<tr class="odd">
<td align="left">374219</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">93</td>
<td align="right">3</td>
<td align="right">23.76000</td>
<td align="right">6.64000</td>
</tr>
<tr class="even">
<td align="left">414936</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">76</td>
<td align="right">3</td>
<td align="right">18.58000</td>
<td align="right">27.98000</td>
</tr>
<tr class="odd">
<td align="left">477059</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">71</td>
<td align="right">3</td>
<td align="right">15.42000</td>
<td align="right">20.38000</td>
</tr>
<tr class="even">
<td align="left">488573</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">60</td>
<td align="right">3</td>
<td align="right">34.00000</td>
<td align="right">30.00000</td>
</tr>
<tr class="odd">
<td align="left">488596</td>
<td align="left">loamy-skeletal</td>
<td align="right">13</td>
<td align="right">50</td>
<td align="right">2</td>
<td align="right">26.00000</td>
<td align="right">50.00000</td>
</tr>
<tr class="even">
<td align="left">530694</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">56</td>
<td align="right">3</td>
<td align="right">29.36842</td>
<td align="right">31.05263</td>
</tr>
<tr class="odd">
<td align="left">530751</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">65</td>
<td align="right">3</td>
<td align="right">28.82000</td>
<td align="right">17.20000</td>
</tr>
<tr class="even">
<td align="left">533172</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">64</td>
<td align="right">3</td>
<td align="right">NaN</td>
<td align="right">0.00000</td>
</tr>
<tr class="odd">
<td align="left">533889</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">61</td>
<td align="right">3</td>
<td align="right">NaN</td>
<td align="right">15.00000</td>
</tr>
<tr class="even">
<td align="left">542125</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">78</td>
<td align="right">3</td>
<td align="right">24.86000</td>
<td align="right">9.28000</td>
</tr>
<tr class="odd">
<td align="left">542131</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">72</td>
<td align="right">3</td>
<td align="right">31.04000</td>
<td align="right">13.56000</td>
</tr>
<tr class="even">
<td align="left">542154</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">73</td>
<td align="right">3</td>
<td align="right">17.54167</td>
<td align="right">0.00000</td>
</tr>
<tr class="odd">
<td align="left">640616</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">75</td>
<td align="right">3</td>
<td align="right">31.84000</td>
<td align="right">2.00000</td>
</tr>
<tr class="even">
<td align="left">894145</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">60</td>
<td align="right">3</td>
<td align="right">20.96000</td>
<td align="right">24.00000</td>
</tr>
</tbody>
</table>
<hr>
<p>Here is a more complex example that adds maximum clay and fragments
to the continuous variables included in the clustering.</p>
<p>It also provides code to compare divisive
<code><a href="https://rdrr.io/pkg/cluster/man/diana.html" class="external-link">cluster::diana()</a></code> and agglomerative
(<code><a href="https://rdrr.io/pkg/cluster/man/agnes.html" class="external-link">cluster::agnes()</a></code>) hierarchical clustering methods as a
method of visualizing “differences” based on a distance matrix.</p>
<p>To further enhance visualization of <em>SoilProfileCollection</em>
objects, plotting of the associated distance matrices with
<code>sharpshootR::plotProfileDendrogram()</code> is demonstrated.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate some continuous quantities for PSCS</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/mutate_profile.html" class="external-link">mutate_profile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">trunc</a></span><span class="op">(</span><span class="va">spc</span>, <span class="va">spc</span><span class="op">$</span><span class="va">pscs_top</span>, <span class="va">spc</span><span class="op">$</span><span class="va">pscs_bottom</span><span class="op">)</span>,</span>
<span>  mc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">clay</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">total_frags_pct</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peiid"</span>, <span class="st">"pc"</span>, <span class="st">"pf"</span>, <span class="st">"mc"</span>, <span class="st">"mf"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">spc</span> <span class="op">&lt;-</span> <span class="va">spc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"rd"</span>, <span class="st">"pc"</span>, <span class="st">"pf"</span>, <span class="st">"dp"</span>, <span class="st">"mc"</span>, <span class="st">"mf"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># set up data frames for various clustering models</span></span>
<span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"taxpartsize"</span>, <span class="st">"rd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"rd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pc"</span>, <span class="st">"pf"</span>, <span class="st">"rd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pc"</span>, <span class="st">"pf"</span>, <span class="st">"dp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"rd"</span>, <span class="st">"pc"</span>, <span class="st">"pf"</span>, <span class="st">"dp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/subset-SoilProfileCollection-method.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"rd"</span>, <span class="st">"pc"</span>, <span class="st">"pf"</span>, <span class="st">"dp"</span>, <span class="st">"mc"</span>, <span class="st">"mf"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">.clusterfun_hclust</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">y</span>, <span class="va">spc</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/profile_id.html" class="external-link">profile_id</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span></span>
<span>  <span class="va">y</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">y</span>, \<span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="kw">else</span> <span class="va">z</span><span class="op">)</span></span>
<span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/daisy.html" class="external-link">daisy</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,<span class="op">]</span>, metric <span class="op">=</span> <span class="st">"gower"</span><span class="op">)</span>,</span>
<span>                method <span class="op">=</span> <span class="st">"centroid"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">.clusterfun_agnes</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">y</span>, <span class="va">spc</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/profile_id.html" class="external-link">profile_id</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span></span>
<span>  <span class="va">y</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">y</span>, \<span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="kw">else</span> <span class="va">z</span><span class="op">)</span></span>
<span>  <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/agnes.html" class="external-link">agnes</a></span><span class="op">(</span><span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/daisy.html" class="external-link">daisy</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,<span class="op">]</span>, metric <span class="op">=</span> <span class="st">"gower"</span><span class="op">)</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"gaverage"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">.clusterfun_diana</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">y</span>, <span class="va">spc</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># NB: code ordinal factors beforehand if needed</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/aqp/man/profile_id.html" class="external-link">profile_id</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span></span>
<span>  <span class="va">y</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">y</span>, \<span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="kw">else</span> <span class="va">z</span><span class="op">)</span></span>
<span>  <span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/diana.html" class="external-link">diana</a></span><span class="op">(</span><span class="fu">cluster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cluster/man/daisy.html" class="external-link">daisy</a></span><span class="op">(</span><span class="va">y</span>, metric <span class="op">=</span> <span class="st">"gower"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># try the following code with the above thre clustering functions</span></span>
<span><span class="va">.CLUSTERFUN</span> <span class="op">&lt;-</span> <span class="va">.clusterfun_diana</span> <span class="co">#.clusterfun_hclust #.clusterfun_agnes</span></span>
<span></span>
<span><span class="co"># the simplest model uses the particle size family and the depth class</span></span>
<span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu">.CLUSTERFUN</span><span class="op">(</span><span class="va">x0</span>, <span class="va">spc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in cluster::daisy(y, metric = "gower"): binary variable(s) 2 treated as</span></span>
<span><span class="co">#&gt; interval scaled</span></span>
<span><span class="fu">aqp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/plotProfileDendrogram.html" class="external-link">plotProfileDendrogram</a></span><span class="op">(</span><span class="va">spc</span>, <span class="va">m0</span>, name <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="similar-soils-loafercreek_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">.CLUSTERFUN</span><span class="op">(</span><span class="va">x1</span>, <span class="va">spc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in cluster::daisy(y, metric = "gower"): binary variable(s) 1, 2 treated</span></span>
<span><span class="co">#&gt; as interval scaled</span></span>
<span><span class="fu">aqp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/plotProfileDendrogram.html" class="external-link">plotProfileDendrogram</a></span><span class="op">(</span><span class="va">spc</span>, <span class="va">m1</span>, name <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu">.CLUSTERFUN</span><span class="op">(</span><span class="va">x2</span>, <span class="va">spc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in cluster::daisy(y, metric = "gower"): binary variable(s) 3 treated as</span></span>
<span><span class="co">#&gt; interval scaled</span></span>
<span><span class="fu">aqp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/plotProfileDendrogram.html" class="external-link">plotProfileDendrogram</a></span><span class="op">(</span><span class="va">spc</span>, <span class="va">m2</span>, name <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="similar-soils-loafercreek_files/figure-html/unnamed-chunk-12-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu">.CLUSTERFUN</span><span class="op">(</span><span class="va">x3</span>, <span class="va">spc</span><span class="op">)</span></span>
<span><span class="fu">aqp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/plotProfileDendrogram.html" class="external-link">plotProfileDendrogram</a></span><span class="op">(</span><span class="va">spc</span>, <span class="va">m3</span>, name <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="similar-soils-loafercreek_files/figure-html/unnamed-chunk-12-3.png" width="672" style="display: block; margin: auto;"></p>
<p><code><a href="https://rdrr.io/pkg/aqp/man/plotProfileDendrogram.html" class="external-link">aqp::plotProfileDendrogram()</a></code> can also take most
arguments you would supply to <code><a href="https://rdrr.io/pkg/aqp/man/SoilProfileCollection-plotting-methods.html" class="external-link">aqp::plotSPC()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu">.CLUSTERFUN</span><span class="op">(</span><span class="va">x4</span>, <span class="va">spc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in cluster::daisy(y, metric = "gower"): binary variable(s) 1, 2 treated</span></span>
<span><span class="co">#&gt; as interval scaled</span></span>
<span><span class="fu">aqp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/plotProfileDendrogram.html" class="external-link">plotProfileDendrogram</a></span><span class="op">(</span></span>
<span>  <span class="va">spc</span>,</span>
<span>  <span class="va">m4</span>,</span>
<span>  print.id <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  depth.axis <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  color <span class="op">=</span> <span class="st">"fragvoltot"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="similar-soils-loafercreek_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">m5</span> <span class="op">&lt;-</span> <span class="fu">.CLUSTERFUN</span><span class="op">(</span><span class="va">x5</span>, <span class="va">spc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in cluster::daisy(y, metric = "gower"): binary variable(s) 1, 2 treated</span></span>
<span><span class="co">#&gt; as interval scaled</span></span>
<span><span class="fu">aqp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/plotProfileDendrogram.html" class="external-link">plotProfileDendrogram</a></span><span class="op">(</span></span>
<span>  <span class="va">spc</span>,</span>
<span>  <span class="va">m5</span>,</span>
<span>  print.id <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  depth.axis <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  color <span class="op">=</span> <span class="st">"fragvoltot"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="similar-soils-loafercreek_files/figure-html/unnamed-chunk-13-2.png" width="672" style="display: block; margin: auto;"></p>
<table class="table">
<thead><tr class="header">
<th align="left">peiid</th>
<th align="left">taxpartsize</th>
<th align="right">rt</th>
<th align="right">dp</th>
<th align="right">rd</th>
<th align="right">pc</th>
<th align="right">pf</th>
<th align="right">mc</th>
<th align="right">mf</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">115595</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">74</td>
<td align="right">3</td>
<td align="right">27.14000</td>
<td align="right">4.60000</td>
<td align="right">35</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">268820</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">64</td>
<td align="right">3</td>
<td align="right">29.46000</td>
<td align="right">15.76000</td>
<td align="right">38</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="left">338023</td>
<td align="left">loamy-skeletal</td>
<td align="right">13</td>
<td align="right">66</td>
<td align="right">3</td>
<td align="right">23.95652</td>
<td align="right">65.26829</td>
<td align="right">25</td>
<td align="right">95</td>
</tr>
<tr class="even">
<td align="left">338040</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">81</td>
<td align="right">3</td>
<td align="right">27.12500</td>
<td align="right">26.25000</td>
<td align="right">30</td>
<td align="right">45</td>
</tr>
<tr class="odd">
<td align="left">351716</td>
<td align="left">loamy-skeletal</td>
<td align="right">13</td>
<td align="right">63</td>
<td align="right">3</td>
<td align="right">28.80000</td>
<td align="right">54.42000</td>
<td align="right">35</td>
<td align="right">75</td>
</tr>
<tr class="even">
<td align="left">374205</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">66</td>
<td align="right">3</td>
<td align="right">30.72000</td>
<td align="right">17.36000</td>
<td align="right">39</td>
<td align="right">40</td>
</tr>
<tr class="odd">
<td align="left">374219</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">93</td>
<td align="right">3</td>
<td align="right">23.76000</td>
<td align="right">6.64000</td>
<td align="right">26</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">414936</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">76</td>
<td align="right">3</td>
<td align="right">18.58000</td>
<td align="right">27.98000</td>
<td align="right">20</td>
<td align="right">35</td>
</tr>
<tr class="odd">
<td align="left">477059</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">71</td>
<td align="right">3</td>
<td align="right">15.42000</td>
<td align="right">20.38000</td>
<td align="right">19</td>
<td align="right">45</td>
</tr>
<tr class="even">
<td align="left">488573</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">60</td>
<td align="right">3</td>
<td align="right">34.00000</td>
<td align="right">30.00000</td>
<td align="right">34</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="left">488596</td>
<td align="left">loamy-skeletal</td>
<td align="right">13</td>
<td align="right">50</td>
<td align="right">2</td>
<td align="right">26.00000</td>
<td align="right">50.00000</td>
<td align="right">26</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="left">530694</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">56</td>
<td align="right">3</td>
<td align="right">29.36842</td>
<td align="right">31.05263</td>
<td align="right">36</td>
<td align="right">50</td>
</tr>
<tr class="odd">
<td align="left">530751</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">65</td>
<td align="right">3</td>
<td align="right">28.82000</td>
<td align="right">17.20000</td>
<td align="right">31</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">542125</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">78</td>
<td align="right">3</td>
<td align="right">24.86000</td>
<td align="right">9.28000</td>
<td align="right">30</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="left">542131</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">72</td>
<td align="right">3</td>
<td align="right">31.04000</td>
<td align="right">13.56000</td>
<td align="right">37</td>
<td align="right">75</td>
</tr>
<tr class="even">
<td align="left">542154</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">73</td>
<td align="right">3</td>
<td align="right">17.54167</td>
<td align="right">0.00000</td>
<td align="right">18</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">640616</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">75</td>
<td align="right">3</td>
<td align="right">31.84000</td>
<td align="right">2.00000</td>
<td align="right">44</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">894145</td>
<td align="left">fine-loamy</td>
<td align="right">7</td>
<td align="right">60</td>
<td align="right">3</td>
<td align="right">20.96000</td>
<td align="right">24.00000</td>
<td align="right">24</td>
<td align="right">30</td>
</tr>
</tbody>
</table></main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andrew Brown.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
